! Command: show running-config
! device: l3 (cEOSLab, EOS-4.34.2F-43232954.4342F.1 (engineering build))
!
no aaa root
!
username admin privilege 15 role network-admin secret sha512 $6$a5FRI7TsB3AYTfZw$QNMeMSoymQydIEQ/WkisU7RBpVF4ctjfqAOkMoBsLmoD7ZudtAccNOHKiBdcb6//4g8QX3oLejZGrCofRlb2G1
!
management api http-commands
   no shutdown
   !
   vrf management
      no shutdown
!
no service interface inactive port-id allocation disabled
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
logging monitor debugging
!
hostname l3
ip host h1 172.16.1.11
ipv6 host h1 fd00::172:16:1:b
ip host h2 172.16.2.12
ipv6 host h2 fd00::172:16:2:c
ip host h3 172.16.1.13
ipv6 host h3 fd00::172:16:1:d
ip host h4 172.16.2.14
ipv6 host h4 fd00::172:16:2:e
ip host h5 172.16.1.15
ipv6 host h5 fd00::172:16:1:f
ip host h6 172.16.2.16
ipv6 host h6 fd00::172:16:2:10
ip host l1 10.0.1.0 10.1.1.1 10.1.2.1 192.168.2.1
ipv6 host l1 fd00::192:168:2:1
ip host l1-blue 172.16.2.3
ipv6 host l1-blue fd00::172:16:2:3
ip host l1-red 172.16.1.3
ipv6 host l1-red fd00::172:16:1:3
ip host l2 10.0.1.1 10.1.1.3 10.1.2.3 192.168.2.2
ipv6 host l2 fd00::192:168:2:2
ip host l2-blue 172.16.2.4
ipv6 host l2-blue fd00::172:16:2:4
ip host l2-red 172.16.1.4
ipv6 host l2-red fd00::172:16:1:4
ip host l3-blue 172.16.2.5
ipv6 host l3-blue fd00::172:16:2:5
ip host l3-red 172.16.1.5
ipv6 host l3-red fd00::172:16:1:5
ip host l4 10.1.1.7 10.1.2.7 192.168.2.4
ipv6 host l4 fd00::192:168:2:4
ip host l4-blue 10.0.5.2 172.16.2.6
ipv6 host l4-blue fd00::10:0:5:2
ip host l4-red 10.0.5.0 172.16.1.6
ipv6 host l4-red fd00::10:0:5:0
ip host r1 10.0.5.1 10.0.5.3 192.168.3.1
ipv6 host r1 fd00::192:168:3:1
ip host s1 10.1.1.0 10.1.1.2 10.1.1.4 10.1.1.6 192.168.1.1
ipv6 host s1 fd00::192:168:1:1
ip host s2 10.1.2.0 10.1.2.2 10.1.2.4 10.1.2.6 192.168.1.2
ipv6 host s2 fd00::192:168:1:2
!
spanning-tree mode mstp
!
system l1
   unsupported speed action error
   unsupported error-correction action error
!
vlan 1000
   name red
!
vlan 1001
   name blue
!
vrf instance blue
   rd 65500:2
!
vrf instance management
!
vrf instance red
   rd 65500:1
!
management api gnmi
   transport grpc default
      vrf management
!
management api netconf
   transport ssh default
      vrf management
!
aaa authorization exec default local
!
interface Ethernet1
   description l3 -> s1
   mac-address 52:dc:ca:fe:05:01
   no switchport
   ip address 10.1.1.5/31
   bfd interval 500 min_rx 500 multiplier 3
   ipv6 address fd00::10:1:1:5/127
   ipv6 nd ra interval msec 5000
   ip ospf neighbor bfd
   ip ospf network point-to-point
   ip ospf authentication
   ip ospf authentication-key 7 iOihGAOfnD7PdNuJs2nx/w==
   ip ospf area 0.0.0.0
   ipv6 ospf bfd
   ipv6 ospf network point-to-point
   ipv6 ospf 1 area 0.0.0.0
!
interface Ethernet2
   description l3 -> s2
   mac-address 52:dc:ca:fe:05:02
   no switchport
   ip address 10.1.2.5/31
   bfd interval 500 min_rx 500 multiplier 3
   ipv6 address fd00::10:1:2:5/127
   ipv6 nd ra interval msec 5000
   ip ospf neighbor bfd
   ip ospf network point-to-point
   ip ospf authentication
   ip ospf authentication-key 7 LzxpZpy5zVMBJ2Bft0kTaA==
   ip ospf area 0.0.0.0
   ipv6 ospf bfd
   ipv6 ospf network point-to-point
   ipv6 ospf 1 area 0.0.0.0
!
interface Ethernet3
   description [Access VLAN red] l3 -> h3
   mac-address 52:dc:ca:fe:05:03
   switchport access vlan 1000
   bfd interval 500 min_rx 500 multiplier 3
!
interface Ethernet4
   description [Access VLAN blue] l3 -> h4
   mac-address 52:dc:ca:fe:05:04
   switchport access vlan 1001
   bfd interval 500 min_rx 500 multiplier 3
!
interface Loopback0
   ip address 192.168.2.3/32
   ipv6 address fd00::192:168:2:3/128
   ipv6 nd ra interval msec 5000
   ip ospf area 0.0.0.0
   ipv6 ospf 1 area 0.0.0.0
!
interface Management0
   vrf management
   ip address 192.168.121.105/24
   no lldp transmit
   no lldp receive
!
interface Vlan1000
   description VLAN red (1000) -> [h1,l2,l1,h3,h5...]
   vrf red
   ip address 172.16.1.5/24
   bfd interval 500 min_rx 500 multiplier 3
   ipv6 address fd00::172:16:1:5/116
   ipv6 nd ra interval msec 5000
   ip virtual-router address 172.16.1.254/24
   ipv6 virtual-router address fd00::172:16:1:ffe
!
interface Vlan1001
   description VLAN blue (1001) -> [h2,l2,l1,h4,h6...]
   vrf blue
   ip address 172.16.2.5/24
   bfd interval 500 min_rx 500 multiplier 3
   ipv6 address fd00::172:16:2:5/116
   ipv6 nd ra interval msec 5000
   ip virtual-router address 172.16.2.254/24
   ipv6 virtual-router address fd00::172:16:2:ffe
!
interface Vxlan1
   vxlan source-interface Loopback0
   vxlan udp-port 4789
   vxlan vlan 1000 vni 101000
   vxlan vlan 1001 vni 101001
   vxlan vrf blue vni 10001
   vxlan vrf red vni 10000
!
ip virtual-router mac-address 02:00:ca:fe:00:ff
!
ip routing
no ip icmp redirect
ip routing vrf blue
no ip routing vrf management
ip routing vrf red
!
ipv6 unicast-routing
ipv6 unicast-routing vrf blue
ipv6 unicast-routing vrf red
!
ip route vrf management 0.0.0.0/0 192.168.121.1
!
mpls ip
!
route-map next-hop-self-ipv4 permit 10
   match route-type external
   set ip next-hop peer-address
!
route-map next-hop-self-ipv4 permit 20
!
route-map next-hop-self-ipv6 permit 10
   match route-type external
   set ipv6 next-hop peer-address
!
route-map next-hop-self-ipv6 permit 20
!
router bgp 65500
   router-id 192.168.2.3
   no bgp default ipv4-unicast
   bgp advertise-inactive
   neighbor 192.168.1.1 remote-as 65500
   neighbor 192.168.1.1 update-source Loopback0
   neighbor 192.168.1.1 description s1
   neighbor 192.168.1.1 send-community standard extended large
   neighbor 192.168.1.2 remote-as 65500
   neighbor 192.168.1.2 update-source Loopback0
   neighbor 192.168.1.2 description s2
   neighbor 192.168.1.2 send-community standard extended large
   neighbor fd00::192:168:1:1 remote-as 65500
   neighbor fd00::192:168:1:1 update-source Loopback0
   neighbor fd00::192:168:1:1 description s1
   neighbor fd00::192:168:1:1 send-community standard extended large
   neighbor fd00::192:168:1:2 remote-as 65500
   neighbor fd00::192:168:1:2 update-source Loopback0
   neighbor fd00::192:168:1:2 description s2
   neighbor fd00::192:168:1:2 send-community standard extended large
   !
   vlan 1000
      rd 192.168.2.3:1000
      route-target import 65000:1000
      route-target export 65000:1000
      redistribute learned
   !
   vlan 1001
      rd 192.168.2.3:1001
      route-target import 65000:1001
      route-target export 65000:1001
      redistribute learned
   !
   address-family evpn
      neighbor 192.168.1.1 activate
      neighbor 192.168.1.2 activate
      neighbor fd00::192:168:1:1 activate
      neighbor fd00::192:168:1:2 activate
   !
   address-family ipv4
      neighbor 192.168.1.1 activate
      neighbor 192.168.1.1 route-map next-hop-self-ipv4 out
      neighbor 192.168.1.2 activate
      neighbor 192.168.1.2 route-map next-hop-self-ipv4 out
      network 192.168.2.3/32
   !
   address-family ipv6
      neighbor fd00::192:168:1:1 activate
      neighbor fd00::192:168:1:1 route-map next-hop-self-ipv6 out
      neighbor fd00::192:168:1:2 activate
      neighbor fd00::192:168:1:2 route-map next-hop-self-ipv6 out
      network fd00::192:168:2:3/128
   !
   vrf blue
      rd 65500:2
      route-target import evpn 65500:2
      route-target export evpn 65500:2
      router-id 192.168.2.3
      redistribute connected
      !
      address-family ipv4
         redistribute connected
      !
      address-family ipv6
         redistribute connected
   !
   vrf red
      rd 65500:1
      route-target import evpn 65500:1
      route-target export evpn 65500:1
      router-id 192.168.2.3
      redistribute connected
      !
      address-family ipv4
         redistribute connected
      !
      address-family ipv6
         redistribute connected
!
router multicast
   ipv4
      software-forwarding kernel
   !
   ipv6
      software-forwarding kernel
!
router ospf 1
   router-id 192.168.2.3
   interface unnumbered hello mask tx 0.0.0.0
   max-lsa 12000
   timers spf delay initial 100 200 500
   timers lsa rx min interval 100
   timers lsa tx delay initial 100 200 500
!
ipv6 router ospf 1
   router-id 192.168.2.3
   timers spf delay initial 100 200 500
   timers lsa rx min interval 100
   timers lsa tx delay initial 100 200 500
!
end