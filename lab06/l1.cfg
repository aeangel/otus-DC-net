frr version 10.3.1_git
frr defaults datacenter
hostname l1
service integrated-vtysh-config
!
vrf mgmt
exit-vrf
!
vrf user
 vni 10000
exit-vrf
!
interface eth1
 description l1 -> s1
 ip address 10.1.1.1/31
 ip ospf area 0.0.0.0
 ip ospf authentication 
 ip ospf authentication-key spine1
 ip ospf bfd
 ip ospf network point-to-point
 ipv6 address fd00::10:1:1:1/127
 ipv6 nd ra-interval 5
 ipv6 ospf6 area 0.0.0.0
 ipv6 ospf6 bfd
 ipv6 ospf6 network point-to-point
 no ipv6 nd suppress-ra
exit
!
interface eth2
 description l1 -> s2
 ip address 10.1.2.1/31
 ip ospf area 0.0.0.0
 ip ospf authentication 
 ip ospf authentication-key spine2
 ip ospf bfd
 ip ospf network point-to-point
 ipv6 address fd00::10:1:2:1/127
 ipv6 nd ra-interval 5
 ipv6 ospf6 area 0.0.0.0
 ipv6 ospf6 bfd
 ipv6 ospf6 network point-to-point
 no ipv6 nd suppress-ra
exit
!
interface eth3
 description [Access VLAN red] l1 -> h1
exit
!
interface lo
 ip address 192.168.2.1/32
 ip ospf area 0.0.0.0
 ipv6 address fd00::192:168:2:1/128
 ipv6 ospf6 area 0.0.0.0
exit
!
interface vlan1000
 description VLAN red (1000) -> [h1,h3,l3]
 ip address 172.16.1.3/24
 ipv6 address fd00::172:16:1:3/116
 ipv6 nd ra-interval 5
 no ipv6 nd suppress-ra
exit
!
router bgp 65500
 bgp router-id 192.168.2.1
 no bgp default ipv4-unicast
 bgp bestpath as-path multipath-relax
 neighbor 192.168.1.1 remote-as 65500
 neighbor 192.168.1.1 description s1
 neighbor 192.168.1.1 update-source lo
 neighbor 192.168.1.2 remote-as 65500
 neighbor 192.168.1.2 description s2
 neighbor 192.168.1.2 update-source lo
 neighbor fd00::192:168:1:1 remote-as 65500
 neighbor fd00::192:168:1:1 description s1
 neighbor fd00::192:168:1:1 update-source lo
 neighbor fd00::192:168:1:2 remote-as 65500
 neighbor fd00::192:168:1:2 description s2
 neighbor fd00::192:168:1:2 update-source lo
 !
 address-family ipv4 unicast
  network 192.168.2.1/32
  neighbor 192.168.1.1 activate
  neighbor 192.168.1.1 next-hop-self
  neighbor 192.168.1.2 activate
  neighbor 192.168.1.2 next-hop-self
 exit-address-family
 !
 address-family ipv6 unicast
  network fd00::192:168:2:1/128
  neighbor fd00::192:168:1:1 activate
  neighbor fd00::192:168:1:1 next-hop-self
  neighbor fd00::192:168:1:2 activate
  neighbor fd00::192:168:1:2 next-hop-self
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor 192.168.1.1 activate
  neighbor 192.168.1.2 activate
  neighbor fd00::192:168:1:1 activate
  neighbor fd00::192:168:1:2 activate
  advertise-all-vni
  vni 101000
   rd 192.168.2.1:1000
   route-target import 65000:1000
   route-target export 65000:1000
  exit-vni
  advertise-svi-ip
  advertise ipv4 unicast
  advertise ipv6 unicast
 exit-address-family
exit
!
router bgp 65500 vrf user
 bgp router-id 192.168.2.1
 no bgp default ipv4-unicast
 !
 address-family ipv4 unicast
  redistribute connected
  label vpn export auto
  rd vpn export 65500:1
  rt vpn both 65500:1
  export vpn
  import vpn
 exit-address-family
 !
 address-family ipv6 unicast
  redistribute connected
  label vpn export auto
  rd vpn export 65500:1
  rt vpn both 65500:1
  export vpn
  import vpn
 exit-address-family
 !
 address-family l2vpn evpn
  advertise ipv4 unicast
  advertise ipv6 unicast
  rd 65500:1
  route-target import 65500:1
  route-target export 65500:1
 exit-address-family
exit
!
router ospf
 ospf router-id 192.168.2.1
 timers throttle spf 10 50 500
 timers throttle lsa all 100
 timers lsa min-arrival 100
exit
!
router ospf6
 ospf6 router-id 192.168.2.1
 timers lsa min-arrival 100
 timers throttle spf 10 50 500
exit
!
